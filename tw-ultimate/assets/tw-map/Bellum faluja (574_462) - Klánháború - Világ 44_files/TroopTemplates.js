var TroopTemplates={current:null,loadTemplate:null,deleteLink:null,currentTemplates:0,maxTemplates:2,init:function(){document.location.hash&&(TroopTemplates.loadTemplate=document.location.hash.substring(1)),TroopTemplates.currentTemplates>=TroopTemplates.maxTemplates?TroopTemplates.loadTemplate||(TroopTemplates.loadTemplate=!0):TroopTemplates.selectCreate(),TroopTemplates.updateTemplateList(),mobile||$("#troop_template_list").css("height",$("#troop_template_units").height()+"px"),$("#template_create").click(TroopTemplates.selectCreate),$("#troop_template_units").find("form").submit(TroopTemplates.validate)},resetSelect:function(e){e.find("option:first").attr("selected","selected").parent("select")},useTemplate:function(e){if("object"==typeof e&&(e=$(e).find("option:selected").val()),e){var t=TroopTemplates.current[e];$.each(t,function(e,t){var a=$("#unit_input_"+e);a.length&&a.val(t)}),$("#template_id").val(e)}return!1},validate:function(){return $("#template_name").val().length<1?(UI.ErrorMessage("A sablonnak érvényes nevet kell megadnod."),!1):$("#template_name").val().length>50?(UI.ErrorMessage("A sablon neve túl hosszú (max.: 50 karakter)"),!1):""!=$("#template_name").val().trim()||(UI.ErrorMessage("A sablonnak legalább 1 látható karaktert kell tartalmaznia."),!1)},updateTemplateList:function(){var e=$("#troop_template_list").find("ul"),t=1;$.each(TroopTemplates.current,function(a,l){l.sanitized_name=$("<a></a>").text(l.name).text(),l.display_name="";for(var o=0;o<l.sanitized_name.length;o++)l.display_name+=l.sanitized_name.charAt(o)+"&shy;";var p=$('<li><a href="#'+l.id+'"></a></li>'),n=p.find("a");n.data("template-id",l.id),n.data("li-id",t),n.click(TroopTemplates.selectTemplate),n.html(l.display_name),e.append(p);var r=$('<img src="/graphic/delete_14.png" alt="" />').click(function(e){e.stopPropagation(),document.location.replace(TroopTemplates.deleteLink+"&id="+l.id)});n.prepend(r),l.id!=TroopTemplates.loadTemplate&&TroopTemplates.loadTemplate!==!0||(TroopTemplates.selectTemplate.call(n),TroopTemplates.loadTemplate=0),t++})},selectCreate:function(e){if("undefined"!=typeof e&&e.preventDefault(),TroopTemplates.currentTemplates>=TroopTemplates.maxTemplates)return UI.ErrorMessage("Elérted a sablonok maximális számát."),!1;var t=mobile?"number":"text";$("#troop_template_units").find("input[type="+t+"]").val(""),$("#template_id").val(0),$("#template_name").val(""),$("#template_button").val("Sablon létrehozása"),TroopTemplates.setSelected(0)},selectTemplate:function(){var e=$(this),t=e.data("template-id"),a=e.data("li-id"),l=TroopTemplates.current[t];TroopTemplates.setSelected(a),$("#template_id").val(l.id),$("#template_name").val(l.name),$("#template_button").val("Sablon módosítása"),$.each(l,function(e,t){var a=$("#unit_input_"+e);a.length&&a.val(t)})},setSelected:function(e){var t=$("#troop_template_list").find("li");t.removeClass("selected"),t.eq(e).addClass("selected")}};
